function [Y,Xf,Af] = pattern_rec_neural_net_model1_f2_v2(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 08-Apr-2016 20:13:25.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = Qx8 matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = Qx1 matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [215.334497084013;156976.661236987;74463.2880752372;55731.5788324809;127854.798368633;7547020.08139208;7547020.08139208;16035080.6452613];
x1_step1_gain = [6.10816940158325e-05;4.8165977857388e-08;1.13267431052643e-07;1.22442245362706e-07;4.88288407991434e-08;2.11338529705331e-09;2.11338529705331e-09;9.21349206740379e-10];
x1_step1_ymin = -1;

% Layer 1
b1 = [2.0307350060866222741;1.7932657928901878375;-1.5818440007903462607;-1.3481868741509923648;1.1893979383890129764;1.0137270237833662101;-0.73802729631493679818;-0.40528397615051175995;0.52232787970130334365;-0.042648560995936300733;0.37986563665276862345;-0.081474340640869349905;-0.61056824012323673845;0.84973394906544497118;-0.91124891965739251987;-1.0823473316827258994;-1.2808405917811496177;1.6281913450280356415;1.4440307589577137115;2.0435599993223747539];
IW1_1 = [-0.27709073859942934259 0.97197862684165514668 0.97912669701886545504 0.50886879313052002516 0.43524275714367355317 -0.69058063739331199127 -0.2000116818846180422 -1.0968034766531318258;-0.91500784294227577309 1.0476146266090018422 0.044136349617348358265 0.35769461630308085898 1.1688505666651525239 -0.7708422344100744894 0.53076704986976031009 -0.0013753793462113819701;0.10141674284573710951 -0.22757170358041584057 -0.48140218234283621568 0.21722070095914319809 0.82045609287339593685 0.75349216730611523474 1.1664963579888683043 1.1063584484861370694;0.29122459742121181714 -1.3383949626252920062 -1.1006314194362307735 -0.28367160404181146482 0.32553726174709296526 0.52229324870773141676 0.58753331824567334163 0.84871575293041012777;-0.68235661103081746148 0.18332587981992934378 -1.1148592649801183363 0.96635746320754467575 0.040779494006264661865 0.4453886591402401729 -0.65942421037526344207 -1.1930756137818323559;-0.60254982595603878703 0.56145518916207570737 0.17632774585961391578 0.79165025276081624206 -0.53838597585358094477 0.80073254747495692385 0.72408235700654099976 -1.0946696046628261456;0.71231072968334718798 -0.58643459175066670053 1.0357878455700142428 0.28511606861206456598 0.090014004271127559531 0.43441808510090423878 -0.83383848564639229117 -1.1129729218648336531;0.28779760340855914391 -0.85342488254278836557 -0.80619886579233479562 0.88135190262971518926 -0.98154992858990597338 0.70044412970098168802 -0.073850310484530029553 -0.8764340338413972864;-0.50299774477117287219 -0.52175897861046927062 0.28841387242419475045 -0.57687339685168559367 -1.3303652464944226708 -1.0195502922440708993 1.1281361889691843281 0.25576996880363339626;-0.9678263125853424631 0.25422682704151555733 -0.24017946327124897743 -0.7774935983551466423 -0.4244446790270023917 1.1068108359289894338 -0.382672110084896544 0.74637671484671053168;-1.6907421776177518069 -1.0637155064474441701 0.020485908958651839057 -0.55140930035369828399 -0.49553338557553094912 -0.25513561185373567763 0.58920534157275594733 0.66466246050041410953;-0.24557841216731932099 0.44747911414164248667 -1.3830412842504953286 0.12227869761062457044 0.8955495581018131368 0.24750848330761532345 -0.52752545457112631766 -0.23797744197579057124;-0.77245206134627486527 0.21176655541025615759 0.13467472627012014308 -0.84702146069131811768 -0.8560883677069167641 0.64437736077242113719 -0.48332814929649503544 1.0656890707731598855;0.78816671862627341039 -0.50273735314626355475 0.23499561125984824717 0.8801911773050273835 -0.011584272262135764109 1.1831485791292162268 0.63870868013972170729 1.0422304911903919056;-0.2225227945971733623 0.056021705788292970596 1.0218484991455378808 0.8052390063158907374 1.0211751567850184674 0.62061942076948384273 -0.7341273849693747966 -0.7240835506613902961;-0.24829083770626292349 0.58541883247563442083 -1.1178167386911086467 -1.0791089301709118065 -0.76973460476787558537 -1.2086954953182180716 0.10443896620270633202 0.20013635976784913129;-1.5446464820156919906 -0.75212806829694789368 -0.58692323844414651113 -1.1030722712979759148 0.44049180261021653182 0.50532335219658519598 -0.17562706311716974605 0.06659517541424282705;0.96590086733932123408 0.95084113180559493017 -0.6201515751826600642 0.086929545153136805746 -0.57899005901517230921 -0.8365314047980419998 -0.31352203356225560871 -0.83569242871490656555;0.61963651857074608653 1.3681157917954971381 -0.72772479120583000167 1.2179317679253953699 0.23544228639861819463 1.2252245724014141359 0.26676726297351149864 0.42709759126964619291;0.39542341039965822613 -1.4171929935956479873 -0.0031476592224295206826 -0.13355034589422121183 -0.93229666916161058055 -0.41997737676392526973 0.7906070343686334434 0.56680841451182906177];

% Layer 2
b2 = 0.071630032507358720739;
LW2_1 = [0.095873010402022257326 -0.52996823006410931356 0.13670826265207527972 -0.65708331933241725942 -0.89042535272830680704 -0.15024187510586453631 0.30426424794810702501 -0.63238534923958544809 1.0923016869101249693 -0.75015352207326591039 1.0693045775394554031 -1.0857369912160199643 -0.36552900367569951534 -0.73593837369217363076 0.41185221485478368253 0.51144862808613600347 -1.3346830845459469739 -0.10060367945430191694 -0.84201035824319803158 0.50644782976074043113];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},1); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    X{1,ts} = X{1,ts}';
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
    Y{1,ts} = Y{1,ts}';
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end
